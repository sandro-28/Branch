üìÇ MASTER CONTEXT : PROJET "BRANCH" (REBOOT)
Ceci est la documentation de r√©f√©rence absolue pour le d√©veloppement de "Branch". Oublie toutes les instructions pr√©c√©dentes qui contredisent ce fichier.

1. L'ARCHITECTURE (NON-N√âGOCIABLE)
Nous construisons un Control Plane (SaaS) pour g√©rer des bases de donn√©es et des d√©ploiements.

H√©bergement : VPS Hostinger (Ubuntu 24.04).

Orchestration : Coolify (install√© sur le VPS).

Base de Donn√©es : Instance Supabase/PostgreSQL h√©berg√©e sur le VPS (g√©r√©e par Coolify).

Code Source : GitHub (sandro-28/Branch).

D√©ploiement : Automatique via Webhook (Git Push Main -> Coolify Pull & Build).

‚õî INTERDIT :

Pas de Vercel.

Pas de docker-compose.yml manuel (Coolify g√®re les conteneurs via Nixpacks).

Pas de base de donn√©es SQLite ou locale.

2. STRAT√âGIE DE CONNEXION DATABASE (CRITIQUE)
La base de donn√©es a deux adresses selon d'o√π on lui parle. Tu dois g√©rer cette dualit√©.

A. En Local (Sur mon PC / D√©veloppement)
Pour les migrations (drizzle-kit push) et le npm run dev.

Host : coolify.sandro.click

Port Public : 5432  (Ex: 6543, voir Coolify)

User : postgres

Password : rL66nTjm9n0ClBoU31eOm6KYeWrZ5WrxvX5alCpbzEXGQuviim3Ojuh7sUdnEDFW

SSL : Obligatoire (?sslmode=require).

B. En Production (Sur le VPS / D√©ploiement)
Pour l'application qui tourne dans le conteneur Docker.

Host Interne : postgresql-database-hwksscs8c0sk44sg0s88o8ws

Port Interne : 5432

User : postgres

Password : rL66nTjm9n0ClBoU31eOm6KYeWrZ5WrxvX5alCpbzEXGQuviim3Ojuh7sUdnEDFW

SSL : Non requis en interne.

3. VARIABLES D'ENVIRONNEMENT (.env.local)
Voici le fichier .env.local que tu dois configurer sur mon poste de d√©veloppement :

Bash

# 1. DATABASE (Connexion Externe pour Dev & Migrations)
DATABASE_URL="postgres://postgres:rL66nTjm9n0ClBoU31eOm6KYeWrZ5WrxvX5alCpbzEXGQuviim3Ojuh7sUdnEDFW@hwksscs8c0sk44sg0s88o8ws:5432/postgres"

# 2. APP URL
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# 3. BETTER AUTH
BETTER_AUTH_URL="http://localhost:3000"
BETTER_AUTH_SECRET="e66f60d5e1d23c8644baadc83419e59a00e32374f203d7fd77160ffcd1a62125"
Note : En production (Coolify), je d√©finirai la DATABASE_URL avec l'h√¥te interne.

4. STACK TECHNIQUE & R√àGLES DE CODE
Backend & Auth
Framework : Next.js 15 (App Router).

Auth : Better-Auth.

‚ö†Ô∏è IMPORTANT : Le fichier de route API doit imp√©rativement √™tre : app/api/auth/[...all]/route.ts.

Configurer trustedOrigins pour accepter https://branch.sandro.click.

ORM : Drizzle ORM.

Workflow Git (GitOps)
Je ne d√©ploie jamais manuellement.

Ton job : Coder -> git add -> git commit -> git push origin main.

Coolify d√©tecte le push et d√©ploie tout seul.

5. INSTRUCTIONS IMM√âDIATES
Si ce n'est pas fait, initialise le projet maintenant :

npx create-next-app@latest . --typescript --tailwind --eslint --no-src-dir

Installe Drizzle (drizzle-orm, drizzle-kit, postgres) et Better-Auth.

Configure drizzle.config.ts pour utiliser la DATABASE_URL du .env.local.

Lance un npx drizzle-kit push pour v√©rifier que tu arrives √† parler au VPS.

Au travail.